var Panopto=Panopto||{};Panopto.BatchUpload=Panopto.BatchUpload||{},Panopto.BatchUpload.fileExtensions=[".avi",".asf",".wmv",".mpg",".mpeg",".ps",".mps",".m2ps",".mp1",".mp2",".m2v",".ts",".tsv",".mts",".m2ts",".mod",".tod",".mp4",".m4v",".3gp",".mov",".qt",".flv",".f4v",".ogg",".ogv",".oga",".ogx",".ogm",".opus",".webm",".mp3",".wma",".m2a",".tsa",".m4a",".f4a",".wav",".flac"],Panopto.BatchUpload.MultipartUploader=function(e){var t,o={NotStarted:0,Uploading:1,Complete:2,Failed:3,Invalid:4},a={},n=0;function i(e){var t=a[e],n=t.file,i=Panopto.Core.ServiceInterface.MultipartUploadManager.predictRemainingSeconds(e);_.extend(this,{BytesUploaded:t.bytesUploaded,Extension:t.ext,Id:e,IsInvalid:t.status===o.Invalid,Name:t.name,PercentUploaded:t.bytesUploaded/n.size*100,RemainingTime:i>=0?moment().startOf("day").seconds(i).format("HH:mm:ss"):"",SessionCreated:!!t.sessionId,SessionId:t.sessionId||Panopto.Core.Constants.EmptyGuid,Size:n.size,UploadInProgress:t.status===o.Uploading,UploadNearCompletion:t.status===o.Uploading&&t.bytesUploaded===n.size,UploadCompleted:t.status===o.Complete})}var l=function(){var e=_.countBy(a,function(e){return e.status});Panopto.BatchUpload.FileList.updateProgress({Total:_.keys(a).length,Invalid:e[o.Invalid]||0,NotStarted:e[o.NotStarted]||0,Uploading:e[o.Uploading]||0,Complete:e[o.Complete]||0,Failed:e[o.Failed]||0})};return e.setupDragDrop=function(a){t=a,Panopto.Core.ServiceInterface.SessionUploadManagement.setHost(window.location.origin);var s=function(e){e.stopPropagation(),e.preventDefault()},p=function(e){s(e),t.toggleClass("drop-target-drag")};_.each(["mouseover","mouseleave","dragover"],function(e){t.on(e,s)}),_.each(["dragenter","dragleave"],function(e){t.on(e,p)});var r=function(t){var a,s,p,r=t.originalEvent,d=r.target.files||r.dataTransfer.files;d.length>0&&(!Panopto.features.enableMultipleUploads&&d.length>1?Panopto.BatchUpload.FileList.reportUploadError("MultiUploadDisabled",2):(s=d,p=[],_.each(s,function(t,a){var l,s;l={file:t,id:n++,name:Panopto.Core.StringHelpers.parseFilename(t.name),ext:Panopto.Core.StringHelpers.parseExtension(t.name),bytesUploaded:0,status:o.NotStarted},(!_.contains(Panopto.BatchUpload.fileExtensions,"."+l.ext)||Panopto.features.uploadByteLimit&&t.size>Panopto.features.uploadByteLimit)&&(l.status=o.Invalid),e.registerFile(l.id,l),(s=new i(l.id)).Index=a+1,p[a]=s}),l(),a=p,Panopto.BatchUpload.FileList.addFiles(a))),u.val(null)};t.on("drop",function(e){p(e),r(e)});var d=!1!==Panopto.BatchUpload.Data.currentFolder.canPassMultiple&&!($.browser.safari&&$.browser.mobile&&$.browser.versionNumber<8)&&Panopto.features.enableMultipleUploads,u=$("<input />",{type:"file",multiple:d,accept:Panopto.BatchUpload.fileExtensions.join(",")}).on("change",r).hide().insertAfter(t);Panopto.Core.UI.Handlers.button(t,function(){u.click()},{keyEvent:"keypress"})},e.registerFile=function(e,t){a[e]=t,l()},e.removeFile=function(e){delete a[e],l()},e.startUpload=function(e,t,n){var s=a[e],p=new Panopto.Core.CancellableRequest,r=new Panopto.Core.CancellableRequest;s.sessionId=t,n=n||$.noop;var d=function(a,p){s.status=a,Panopto.BatchUpload.FileList.updateFile(new i(e)),l(),a===o.Complete&&n(!0),a===o.Failed&&(Panopto.BatchUpload.FileList.handleImportError(e,t,p),n(!1))};return s.status!==o.Invalid&&(d(o.Uploading),p=Panopto.Core.ServiceInterface.SessionUploadManagement.openUpload({sessionId:t,filename:s.file.name,startTime:new Date},function(t){s.uploadId=t.ID,Panopto.Core.ServiceInterface.MultipartUploadManager.queueUpload({file:s.file,fileId:e,uploadUri:t.UploadTarget},function(t){s.bytesUploaded=t,Panopto.BatchUpload.FileList.updateFile(new i(e))},function(){r=Panopto.Core.ServiceInterface.SessionUploadManagement.closeUpload(t,function(){d(o.Complete)},function(){d(o.Failed,"Failed to close upload.")})},function(){d(o.Failed,"Failed to upload file.")}),Panopto.Core.ServiceInterface.MultipartUploadManager.upload()},function(){d(o.Failed,"Failed to open upload.")})),new Panopto.Core.CancellableRequest(function(){p.cancel(),r.cancel()})},e.stopUpload=function(e){var t=a[e];t.status=o.NotStarted,t.bytesUploaded=0,l(),Panopto.Core.ServiceInterface.MultipartUploadManager.cancelUpload(e)},e.pauseUpload=function(e){},e.resumeUpload=function(e){},e.uploadStarted=function(e){return!!a[e]&&a[e].status!==o.NotStarted},e.uploadCompleted=function(e){return!!a[e]&&a[e].status===o.Complete},e.isInvalid=function(e){return!a[e]||a[e].status===o.Invalid},e.getSessionId=function(e){return a[e]&&a[e].sessionId?a[e].sessionId:Panopto.Core.Constants.EmptyGuid},e.resetSessionId=function(e){var t=a[e];t&&(t.sessionId=null,Panopto.BatchUpload.FileList.updateFile(new i(e)))},e.setTargetText=function(e){t.find(".uploader-text").text(e)},e.setComponent=function(e,t){e.Simulate=t},e}(Panopto.BatchUpload.MultipartUploader||{});
//# sourceMappingURL=file://seasyn/tfsbuilds/panopto_core_rel-rtc-9.9.2_x64/20201026.33/_PublishedWebsites/WebUI/Scripts/Panopto/BatchUpload/MultipartUploader.js.map
